async function registrarServico(manual = false) {
  if (modo !== "apontamento") return alert("Você não tem permissão para registrar.");

  const obs = document.getElementById("observations").value.trim();
  if (!obs) return alert("Preencha a descrição do serviço.");

  let dataRegistro;
  if (manual) {
    const dataInput = document.getElementById("manualDate").value;
    if (!dataInput) return alert("Selecione uma data manual.");
    const partes = dataInput.split("-");
    dataRegistro = `${partes[2]}/${partes[1]}/${partes[0]}`;
  } else {
    dataRegistro = new Date().toLocaleDateString();
  }

  // Pega o valor individual do dia e verifica se é um número válido
  const valorDiaIndividual = parseFloat(document.getElementById("valorDiaIndividual").value);
  if (isNaN(valorDiaIndividual) || valorDiaIndividual <= 0) {
    return alert("Por favor, insira um valor válido para o dia.");
  }

  // Atualizando a tabela diretamente
  const table = document.getElementById("observationsTable");
  const row = document.createElement("tr");

  const cellData = document.createElement("td");
  const cellText = document.createElement("td");
  const cellValor = document.createElement("td");
  const cellConfirm = document.createElement("td");

  const valorFormatado = valorDiaIndividual.toFixed(2); // Formatar o valor para 2 casas decimais

  // Preenche as células
  cellData.innerText = dataRegistro;
  cellText.innerText = obs;
  cellValor.innerText = `R$ ${valorFormatado}`; // Exibir o valor do dia corretamente

  const confirmButton = document.createElement("button");
  confirmButton.innerText = "Confirmar";
  confirmButton.onclick = function () {
    const confirmSave = confirm("Você tem certeza que deseja salvar essa edição?");
    if (confirmSave) {
      salvarNoFirebase(); // Salva os dados no Firebase
    }
  };

  cellConfirm.appendChild(confirmButton);
  row.appendChild(cellData);
  row.appendChild(cellText);
  row.appendChild(cellValor);
  row.appendChild(cellConfirm);

  table.appendChild(row); // Insere a nova linha na tabela

  // Atualiza os dias e total
  const dias = parseInt(document.getElementById("daysWorked").value) || 0;
  document.getElementById("daysWorked").value = dias + 1;
  atualizarValores();

  // Limpa os campos
  document.getElementById("observations").value = "";
  document.getElementById("manualDate").value = "";

  // Salvar no Firebase
  await salvarNoFirebase();
}
