<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SARIPAN</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#007BFF" />
  <link rel="icon" href="icon-192.png" />
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js');
      });
    }
  </script>
  <style>
    body {
      padding: 20px;
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
    }
    .container {
      background: white;
      padding: 20px;
      border-radius: 10px;
      max-width: 600px;
      margin: auto;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
    }
    .field {
      margin-bottom: 15px;
    }
    .field label {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
    }
    .field input, .field textarea {
      width: 100%;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    .buttons {
      text-align: center;
      margin-top: 15px;
    }
    .buttons button {
      padding: 10px 20px;
      margin: 5px;
      border-radius: 5px;
      border: none;
      background-color: #007BFF;
      color: white;
      cursor: pointer;
    }
    .buttons button:hover {
      background-color: #0056b3;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 30px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
    }
    th {
      background-color: #007BFF;
      color: white;
    }
    tfoot td {
      font-weight: bold;
      text-align: right;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>SARIPAN</h1>

    <div class="field">
      <label>Data:</label>
      <input type="text" id="datetime" readonly />
    </div>

    <div class="field">
      <label>Dias Trabalhados:</label>
      <input type="number" id="daysWorked" value="0" readonly />
    </div>

    <div class="field">
      <label>Total a Receber:</label>
      <div style="display: flex; align-items: center;">
        <span style="margin-right: 5px;">R$</span>
        <input type="number" id="totalToReceive" value="0" readonly style="flex: 1;" />
      </div>
    </div>

    <div class="field">
      <label>Serviços realizados:</label>
      <textarea id="observations" placeholder="Descreva o serviço realizado..."></textarea>
    </div>

    <div class="buttons">
      <button onclick="incrementDays()">Ponto</button>
      <button onclick="resetAll()">Zerar Tudo</button>
      <button onclick="addObservation()">Registrar Serviço</button>
      <button onclick="exportToCSV()">Exportar CSV</button>
      <button onclick="exportToPDF()">Exportar PDF</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>Data</th>
          <th>Serviço</th>
        </tr>
      </thead>
      <tbody id="observationsTable"></tbody>
      <tfoot>
        <tr>
          <td colspan="2" id="tableTotalRow">Total a Receber: R$ 0</td>
        </tr>
      </tfoot>
    </table>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    function updateDateTime() {
      const now = new Date();
      document.getElementById("datetime").value = now.toLocaleString();
    }

    function updateTotalToReceive() {
      const days = parseInt(document.getElementById("daysWorked").value);
      const total = days * 100;
      document.getElementById("totalToReceive").value = total;
      document.getElementById("tableTotalRow").innerText = "Total a Receber: R$ " + total;
    }

    function incrementDays() {
      const senha = prompt("Digite a senha:");
      if (senha !== "1234") {
        alert("Senha incorreta!");
        return;
      }
      const input = document.getElementById("daysWorked");
      input.value = parseInt(input.value) + 1;
      updateTotalToReceive();
      saveData();
    }

    function resetAll() {
      const senha = prompt("Digite a senha:");
      if (senha !== "1234") {
        alert("Senha incorreta!");
        return;
      }
      document.getElementById("daysWorked").value = 0;
      document.getElementById("totalToReceive").value = 0;
      document.getElementById("observations").value = "";
      document.getElementById("observationsTable").innerHTML = "";
      document.getElementById("tableTotalRow").innerText = "Total a Receber: R$ 0";
      localStorage.removeItem("saripanData");
    }

    function addObservation() {
      const obs = document.getElementById("observations").value.trim();
      if (!obs) return;
      const row = document.getElementById("observationsTable").insertRow();
      row.insertCell(0).innerText = new Date().toLocaleDateString();
      row.insertCell(1).innerText = obs;
      document.getElementById("observations").value = "";
      saveData();
    }

    function saveData() {
      const data = {
        daysWorked: document.getElementById("daysWorked").value,
        observations: []
      };
      document.querySelectorAll("#observationsTable tr").forEach(row => {
        data.observations.push({
          date: row.cells[0].innerText,
          text: row.cells[1].innerText
        });
      });
      localStorage.setItem("saripanData", JSON.stringify(data));
      updateTotalToReceive();
    }

    function loadData() {
      const data = JSON.parse(localStorage.getItem("saripanData"));
      if (!data) return;
      document.getElementById("daysWorked").value = data.daysWorked;
      const tbody = document.getElementById("observationsTable");
      tbody.innerHTML = "";
      data.observations.forEach(obs => {
        const row = tbody.insertRow();
        row.insertCell(0).innerText = obs.date;
        row.insertCell(1).innerText = obs.text;
      });
      updateTotalToReceive();
    }

    function exportToCSV() {
      let csv = "Data,Serviço\\n";
      document.querySelectorAll("#observationsTable tr").forEach(row => {
        const date = row.cells[0].innerText;
        const text = row.cells[1].innerText;
        csv += `"${date}","${text}"\\n`;
      });
      const blob = new Blob([csv], { type: "text/csv" });
      const url = URL.createObjectURL(blob);
      const link = document.createElement("a");
      link.href = url;
      link.download = "servicos.csv";
      link.click();
    }

    async function exportToPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.setFontSize(16);
      doc.text("Apontamento de Serviços", 105, 10, { align: "center" });
      doc.setFontSize(12);
      let y = 20;
      document.querySelectorAll("#observationsTable tr").forEach(row => {
        doc.text(row.cells[0].innerText + " - " + row.cells[1].innerText, 10, y);
        y += 8;
      });
      y += 10;
      const total = document.getElementById("totalToReceive").value;
      doc.setFont(undefined, "bold");
      doc.text("Total a Receber: R$ " + total, 200, y, { align: "right" });
      doc.save("servicos.pdf");
    }

    setInterval(updateDateTime, 1000);
    window.onload = () => {
      loadData();
      updateDateTime();
    };
  </script>
</body>
</html>
